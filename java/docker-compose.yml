networks:
    my_network:
        name: my_network

services:
    postgres:
        container_name: my_postgres
        environment:
            POSTGRES_DB: postgres
            POSTGRES_USER: admin
            POSTGRES_PASSWORD: secret
            PGDATA: /var/lib/postgresql/data
        image: postgres
        networks:
            - my_network
        ports:
            - "5432:5432"
        #command: 'psql -U admin -d postgres -f /docker-entrypoint-initdb.d/init.sql  -w'
        volumes:
            - ./infra/postgres/init.sql:/docker-entrypoint-initdb.d/init.sql

    pgAdmin:
        container_name: my_pgAdmin
        depends_on:
            - postgres
        environment:
            PGADMIN_DEFAULT_EMAIL: "admin@whatever.com"
            PGADMIN_DEFAULT_PASSWORD: "admin"
            PGADMIN_LISTEN_PORT: 80
            PGPASSFILE: "/pgadmin4/pgpass"
        image: dpage/pgadmin4
        networks:
            - my_network
        ports:
            - "5050:80"
        volumes:
            - ./infra/pgadmin/servers.json:/pgadmin4/servers.json
            - ./infra/pgadmin/pgpass:/pgadmin4/pgpass

    rabbitmq:
        container_name: my_rabbit
        image: 'rabbitmq:4.1-management'
        networks:
            - my_network
        environment:
            - 'RABBITMQ_DEFAULT_PASS=admin'
            - 'RABBITMQ_DEFAULT_USER=admin'
        ports:
            - '5672:5672' # rabbitmq tcp default
            - '15672:15672' # localhost:15672 admin console
        volumes:
            #- ./infra/rabbitmq/data/:/var/lib/rabbitmq/mnesia/ # can cause phantom data issues if merged with a new definitions file
            #- ./infra/rabbitmq/advanced.config:/etc/rabbitmq/advanced.config
            - ./infra/rabbitmq/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf
            - ./infra/rabbitmq/definitions.json:/etc/rabbitmq/definitions.json
            - ./infra/rabbitmq/enabled_plugins:/etc/rabbitmq/enabled_plugins
